<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"> -->
</head>
<body>
  <app-root></app-root>
  <p>Gmail API Quickstart</p>

   <!--Add buttons to initiate auth sequence and sign out-->
   <button id="authorize-button" style="display: none;">Authorize</button>
   <button id="signout-button" style="display: none;">Sign Out</button>
   <button id="msg" onClick="getMessages()">Get Messages</button>

      <p id="demo"></p>



   <pre id="content"></pre>

   <script type="text/javascript">
     // Client ID and API key from the Developer Console
     var CLIENT_ID = '368199083376-bsph79es2nam7f65o45r5680olud6kqr.apps.googleusercontent.com';

     // Array of API discovery doc URLs for APIs used by the quickstart
     var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"];

     // Authorization scopes required by the API; multiple scopes can be
     // included, separated by spaces.
     var SCOPES = 'https://www.googleapis.com/auth/gmail.readonly';

     var authorizeButton = document.getElementById('authorize-button');
     var signoutButton = document.getElementById('signout-button');

     /**
      *  On load, called to load the auth2 library and API client library.
      */
     function handleClientLoad() {
       gapi.load('client:auth2', initClient);
     }

     /**
      *  Initializes the API client library and sets up sign-in state
      *  listeners.
      */
     function initClient() {
       gapi.client.init({
         discoveryDocs: DISCOVERY_DOCS,
         clientId: CLIENT_ID,
         scope: SCOPES
       }).then(function () {
         // Listen for sign-in state changes.
         gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

         // Handle the initial sign-in state.
         updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
         authorizeButton.onclick = handleAuthClick;
         signoutButton.onclick = handleSignoutClick;
       });
     }

     /**
      *  Called when the signed in status changes, to update the UI
      *  appropriately. After a sign-in, the API is called.
      */
     function updateSigninStatus(isSignedIn) {
       if (isSignedIn) {
         authorizeButton.style.display = 'none';
         signoutButton.style.display = 'block';
         //listLabels();
         listMessages('me', 5, function(result) {
           console.log("+++++++++++++++++++++");
           // get all message as a list formate
           console.log(result);
           console .log("_______________________")
        //   console.log(result[1].id);
  for(var i=1;i<=8;i++)
  {
           getMessage('me', result[i].id, function(msg) {
            //  console.log(msg)
              // console.log(msg.historyId);
              // console.log("this is paly load value ");
              //console.log(msg.payload.headers[16].value);
              var fruits = [];
               console.log(msg.payload.headers.length);
              for(var t=0;t<msg.payload.headers.length;t++)
              {
                //console.log("hello for");
              if(msg.payload.headers[t].name=='Subject')
              {
              console.log(msg.payload.headers[t].value);
              fruits.push(msg.payload.headers[t].value);

            //  document.write("<h1>"+msg.payload.headers[t].value+"</h1>");
            //  document.getElementById("demo").innerHTML = msg.payload.headers[t].value;
            }
          //  document.getElementById("demo").innerHTML = msg.payload.headers[t].value;
            if(msg.payload.headers[t].name=='Date')
            {
            console.log(msg.payload.headers[t].value);
          }
          }

          for(var y=0;y<fruits.length;y++)
          {
            console.log("helo"+ fruits[y]);
          }

        //  fruits.toString();
     document.getElementById("demo").innerHTML = fruits;



// +" , "+msg.payload.headers[16].name+", "+msg.payload.headers[21].name);
              //console.log(msg.payload);
              // console.log("this is paly result value ");
              // console.log(msg.result);

           })
         }
         });
       } else {
         authorizeButton.style.display = 'block';
         signoutButton.style.display = 'none';
       }
     }

     function getMessage(userId, messageId, callback) {
  var request = gapi.client.gmail.users.messages.get({
    'userId': userId,
    'id': messageId
  });
  request.execute(callback);
}

     /**
      *  Sign in the user upon button click.
      */
     function handleAuthClick(event) {
       gapi.auth2.getAuthInstance().signIn();
     }

     /**
      *  Sign out the user upon button click.
      */
     function handleSignoutClick(event) {
       gapi.auth2.getAuthInstance().signOut();
     }

     /**
      * Append a pre element to the body containing the given message
      * as its text node. Used to display the results of the API call.
      *
      * @param {string} message Text to be placed in pre element.
      */
     function appendPre(message) {
       var pre = document.getElementById('content');
       var textContent = document.createTextNode(message + '\n');
       pre.appendChild(textContent);
     }

     /**
      * Print all Labels in the authorized user's inbox. If no labels
      * are found an appropriate message is printed.
      */
     function listLabels() {
       gapi.client.gmail.users.labels.list({
         'userId': 'me'
       }).then(function(response) {
         var labels = response.result.labels;
         appendPre('Labels:');

         if (labels && labels.length > 0) {
           for (i = 0; i < labels.length; i++) {
             var label = labels[i];
             appendPre(label.name)
           }
         } else {
           appendPre('No Labels found.');
         }
       });
     }


// to get the messages here
function getMessages () {
  //listMessages
}


function listMessages(userId, query, callback) {
  var getPageOfMessages = function(request, result) {
    request.execute(function(resp) {
      result = result.concat(resp.messages);
      var nextPageToken = resp.nextPageToken;
      if (nextPageToken) {
        request = gapi.client.gmail.users.messages.list({
          'userId': userId,
          'pageToken': nextPageToken,
          'q': query
        });
        getPageOfMessages(request, result);
      } else {
        callback(result);
      }
    });
  };
  var initialRequest = gapi.client.gmail.users.messages.list({
    'userId': userId,
    'q': query
  });
  getPageOfMessages(initialRequest, []);
}
   </script>

   <script async defer src="https://apis.google.com/js/api.js"
     onload="this.onload=function(){};handleClientLoad()"
     onreadystatechange="if (this.readyState === 'complete') this.onload()">
   </script>

  <!-- <script src="toastr.js"></script> -->
  <script
			  src="https://code.jquery.com/jquery-2.2.4.min.js"
			  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
			  crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
   <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>

</body>
</html>
